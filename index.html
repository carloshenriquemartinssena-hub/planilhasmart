<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Finance Ultra Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="login-overlay" class="overlay">
        <div class="login-box">
            <h2 id="login-title">Smart Finance Pro</h2>
            <p id="login-desc">Sincronize com o Google para salvar por anos.</p>
            <button onclick="loginGoogle()" class="btn-google" id="btn-login-main">Entrar com Google</button>
            
            <div id="cadastro-form" style="display:none; margin-top:20px; text-align: left;">
                <label>Nome Completo*</label><input type="text" id="reg-nome">
                <label>Telefone*</label><input type="tel" id="reg-tel">
                <label>Apelido (Pop-ups)</label><input type="text" id="reg-apelido">
                <button onclick="salvarPerfil()" class="btn-add" style="margin-top:15px">Finalizar Cadastro</button>
            </div>
        </div>
    </div> 

    <nav class="sidebar">
        <div class="logo">SMART FINANCE</div>
        <ul class="nav-links">
            <li class="active" onclick="navegar('dash')">üìä Dashboard</li>
            <li onclick="navegar('analise')">üìà An√°lise Detalhada</li>
            <li onclick="navegar('config')">‚öôÔ∏è Configura√ß√µes</li>
            <li onclick="navegar('faq')">‚ùì FAQ</li>
        </ul>
        <div class="popup-control">
            <label><input type="checkbox" id="popup-check" checked> Social Pop-ups</label>
        </div>
    </nav>

    <main class="main-content">
        <section id="sec-dash">
            <header class="hero-banner">
                <h1 id="welcome-text">Bem-vindo!</h1>
                <p id="ai-insight">Dica: Reduza gastos no Cr√©dito para atingir sua meta mais r√°pido.</p>
            </header>

            <div class="metrics-bar">
                <div class="metric"><h4>Saldo Real</h4><span id="bal-total">R$ 0,00</span></div>
                <div class="metric"><h4>Entradas</h4><span id="bal-in" class="text-success">R$ 0,00</span></div>
                <div class="metric"><h4>Sa√≠das</h4><span id="bal-out" class="text-danger">R$ 0,00</span></div>
            </div>

            <div class="dashboard-grid">
                <div class="column">
                    <div class="card">
                        <h3>Diversifica√ß√£o</h3>
                        <div class="chart-container"><canvas id="mainChart"></canvas></div>
                    </div>
                    <div class="card">
                        <h3>Extrato</h3>
                        <div class="table-container">
                            <table id="table-extrato"></table>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="card">
                        <h3>Nova Transa√ß√£o</h3>
                        <form id="finance-form" class="smart-form">
                            <input type="text" id="f-desc" placeholder="Descri√ß√£o" required>
                            <input type="number" id="f-val" placeholder="R$ Valor" step="0.01" required>
                            <select id="f-method">
                                <option>Dinheiro/Pix</option>
                                <option>D√©bito</option>
                                <option>Cr√©dito</option>
                            </select>
                            <select id="f-type">
                                <option value="in">Entrada</option>
                                <option value="out" selected>Sa√≠da</option>
                            </select>
                            <input type="date" id="f-date" required>
                            <button type="submit" class="btn-add">Salvar no Google</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <section id="sec-analise" style="display:none">
            <div class="card">
                <h2>üìà An√°lise Mensal Detalhada</h2>
                <div class="analysis-split">
                    <div class="text-success"><h3>Boas Pr√°ticas</h3><ul id="list-boas"></ul></div>
                    <div class="text-danger"><h3>M√°s Pr√°ticas</h3><ul id="list-mas"></ul></div>
                </div>
            </div>
        </section>

        <section id="sec-config" style="display:none">
            <div class="card">
                <h2>‚öôÔ∏è Configura√ß√µes</h2>
                <p>E-mail: <span id="user-mail-display">...</span></p>
                <button onclick="excluirConta()" class="btn-delete">Excluir Conta Permanentemente</button>
            </div>
        </section>

        <section id="sec-faq" style="display:none">
            <div class="card">
                <h2>‚ùì FAQ</h2>
                <p><strong>Como meus dados s√£o salvos?</strong><br>Usamos o Google Firestore para manter seus dados seguros.</p>
            </div>
        </section>
    </main>

    <div id="social-toast" class="toast">Fulano atingiu um objetivo! üéâ</div>

    <script src="app.js">// CONFIGURA√á√ÉO FIREBASE
const firebaseConfig = {
    apiKey: "AIzaSyAyIlBwH809CXTPl3JvbzAutOpqMpr-oGk",
    authDomain: "meufinanceirosmart.firebaseapp.com",
    projectId: "meufinanceirosmart",
    storageBucket: "meufinanceirosmart.firebasestorage.app",
    messagingSenderId: "540463598334",
    appId: "1:540463598334:web:33c06d19288c7049e433af"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let myChart;
let userData = { transactions: [] };

// NAVEGA√á√ÉO
function navegar(id) {
    document.querySelectorAll('main section').forEach(s => s.style.display = 'none');
    document.getElementById('sec-' + id).style.display = 'block';
    
    // Atualiza classe ativa no menu
    const links = document.querySelectorAll('.nav-links li');
    links.forEach(l => l.classList.remove('active'));
    event.currentTarget.classList.add('active');
}

// AUTENTICA√á√ÉO GOOGLE
function loginGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(res => {
        db.collection("usuarios").doc(res.user.uid).get().then(doc => {
            if (doc.exists) { 
                entrar(res.user); 
            } else { 
                document.getElementById('btn-login-main').style.display = 'none';
                document.getElementById('cadastro-form').style.display = 'block';
            }
        });
    }).catch(err => alert("Erro ao logar: " + err.message));
}

function salvarPerfil() {
    const nome = document.getElementById('reg-nome').value;
    const tel = document.getElementById('reg-tel').value;
    
    if(!nome || !tel) return alert("Preencha os campos obrigat√≥rios!");

    const perfil = {
        nome: nome,
        tel: tel,
        apelido: document.getElementById('reg-apelido').value || "Membro Smart",
        email: auth.currentUser.email,
        dataCriacao: new Date()
    };

    db.collection("usuarios").doc(auth.currentUser.uid).set(perfil).then(() => {
        entrar(auth.currentUser);
    });
}

function entrar(user) {
    document.getElementById('login-overlay').style.display = 'none';
    document.getElementById('welcome-text').innerText = "Ol√°, " + (user.displayName || "Usu√°rio");
    document.getElementById('user-mail-display').innerText = user.email;
    carregarDados();
}

// MANIPULA√á√ÉO DE DADOS
function carregarDados() {
    db.collection("usuarios").doc(auth.currentUser.uid).collection("transacoes")
    .orderBy("date", "desc")
    .onSnapshot(snap => {
        userData.transactions = snap.docs.map(d => d.data());
        renderUI();
    });
}

function renderUI() {
    const listIn = userData.transactions.filter(t => t.type === 'in');
    const listOut = userData.transactions.filter(t => t.type === 'out');
    
    const totalIn = listIn.reduce((a,b) => a + b.val, 0);
    const totalOut = listOut.reduce((a,b) => a + b.val, 0);

    document.getElementById('bal-total').innerText = "R$ " + (totalIn - totalOut).toFixed(2);
    document.getElementById('bal-in').innerText = "R$ " + totalIn.toFixed(2);
    document.getElementById('bal-out').innerText = "R$ " + totalOut.toFixed(2);

    // Atualizar Tabela
    const tbody = document.getElementById('table-extrato');
    tbody.innerHTML = userData.transactions.slice(0, 10).map(t => `
        <tr style="border-bottom: 1px solid #334155;">
            <td style="padding:10px">${t.date}</td>
            <td>${t.desc}</td>
            <td class="${t.type === 'in' ? 'text-success' : 'text-danger'}">
                R$ ${t.val.toFixed(2)}
            </td>
        </tr>
    `).join('');

    // Atualizar Gr√°fico
    const methods = ['Dinheiro/Pix', 'D√©bito', 'Cr√©dito'];
    const vals = methods.map(m => listOut.filter(t => t.method === m).reduce((a,b) => a + b.val, 0));
    myChart.data.datasets[0].data = vals;
    myChart.update();

    // Intelig√™ncia de Pr√°ticas
    document.getElementById('list-boas').innerHTML = totalIn > totalOut ? "<li>Saldo mensal positivo.</li>" : "";
    document.getElementById('list-mas').innerHTML = vals[2] > (totalIn * 0.3) ? "<li>Uso de cr√©dito acima do recomend√°vel (30%).</li>" : "";
}

// EVENTOS
document.getElementById('finance-form').onsubmit = (e) => {
    e.preventDefault();
    const t = {
        desc: document.getElementById('f-desc').value,
        val: parseFloat(document.getElementById('f-val').value),
        method: document.getElementById('f-method').value,
        type: document.getElementById('f-type').value,
        date: document.getElementById('f-date').value
    };
    db.collection("usuarios").doc(auth.currentUser.uid).collection("transacoes").add(t);
    e.target.reset();
};

function excluirConta() {
    if(confirm("Deseja excluir permanentemente sua conta e todos os seus dados?")) {
        db.collection("usuarios").doc(auth.currentUser.uid).delete().then(() => {
            alert("Conta exclu√≠da com sucesso, boa sorte na sua jornada!");
            location.reload();
        });
    }
}

// Inicializar Gr√°fico ao carregar
window.onload = () => {
    const ctx = document.getElementById('mainChart').getContext('2d');
    myChart = new Chart(ctx, {
        type: 'doughnut',
        data: { 
            labels: ['Pix', 'D√©bito', 'Cr√©dito'], 
            datasets: [{ 
                data:[0,0,0], 
                backgroundColor:['#6366f1','#a855f7','#ef4444'],
                borderWidth: 0
            }] 
        },
        options: { 
            maintainAspectRatio: false, 
            plugins: { legend: { position: 'bottom', labels: {color:'#fff'} } } 
        }
    });
};</script>
</body>

</html>

